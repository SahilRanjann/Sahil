<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>For Satakshi</title>
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Quicksand:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body {
      /* Animated gradient background */
      background: linear-gradient(120deg, #ffe0ec 0%, #e0c3fc 100%);
      min-height: 100vh;
      margin: 0;
      font-family: 'Quicksand', 'Segoe UI', Arial, sans-serif;
      position: relative;
      overflow-x: hidden;
    }
    /* Animated floating hearts (more, with random animation) */
    .floating-heart {
      position: fixed;
      pointer-events: none;
      z-index: 0;
      opacity: 0.18;
      animation: floatHeart 8s linear infinite;
      will-change: transform, opacity;
    }
    .floating-heart.heart-anim {
      opacity: 0.10;
      animation: floatHeartVar 12s linear infinite;
    }
    @keyframes floatHeart {
      0% { transform: translateY(100vh) scale(1) rotate(0deg);}
      100% { transform: translateY(-10vh) scale(1.2) rotate(30deg);}
    }
    @keyframes floatHeartVar {
      0% { transform: translateY(110vh) scale(0.8) rotate(-10deg);}
      100% { transform: translateY(-20vh) scale(1.3) rotate(40deg);}
    }
    /* Main Card Glassmorphism */
    .main-card {
      position: relative;
      background: rgba(255,255,255,0.85);
      margin: 48px auto 28px auto;
      padding: 36px 32px 28px 32px;
      border-radius: 22px;
      box-shadow: 0 8px 40px 0 rgba(123,47,242,0.13), 0 1.5px 18px 0 rgba(255,94,174,0.09);
      width: 370px;
      max-width: 92vw;
      min-height: 240px;
      display: flex;
      flex-direction: column;
      align-items: center;
      border: 2.5px solid rgba(215,38,96,0.13);
      backdrop-filter: blur(6px);
      /* Glowing border */
      box-shadow: 0 0 0 4px #ffb6ea44, 0 8px 40px 0 rgba(123,47,242,0.13);
    }
    .heart {
      position: absolute;
      width: 38px;
      height: 38px;
      top: -18px;
    }
    .heart.left {
      left: -18px;
    }
    .heart.right {
      right: -18px;
      transform: scaleX(-1);
    }
    .main-card h2 {
      margin-top: 12px;
      margin-bottom: 18px;
      font-size: 2em;
      color: #d72660;
      letter-spacing: 1.5px;
      font-family: 'Pacifico', cursive, sans-serif;
      text-shadow: 0 2px 12px #ffb6ea55;
    }
    .main-card .apology {
      font-size: 1.13em;
      color: #444;
      margin-bottom: 28px;
      text-align: center;
      font-family: 'Quicksand', Arial, sans-serif;
      line-height: 1.6;
    }
    .main-card .signature {
      margin-top: 18px;
      font-size: 1.05em;
      color: #7b2ff2;
      text-align: right;
      width: 100%;
      font-family: 'Pacifico', cursive, sans-serif;
      letter-spacing: 0.5px;
    }
    /* Spotify Section */
    .spotify-section {
      background: rgba(245,245,247,0.97);
      border-radius: 18px;
      padding: 28px 20px 22px 20px;
      margin: 0 auto 36px auto;
      width: 370px;
      max-width: 92vw;
      box-shadow: 0 2px 18px 0 rgba(123,47,242,0.09);
      border: 2px solid #e0c3fc;
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
      /* Glowing border */
      box-shadow: 0 0 0 3px #1db95422, 0 2px 18px 0 rgba(123,47,242,0.09);
    }
    .spotify-section h3 {
      margin-top: 0;
      margin-bottom: 16px;
      color: #1db954;
      font-size: 1.25em;
      letter-spacing: 0.7px;
      font-family: 'Quicksand', Arial, sans-serif;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .spotify-section .music-note {
      font-size: 1.3em;
      color: #1db954;
      vertical-align: middle;
      margin-right: 2px;
      filter: drop-shadow(0 1px 2px #1db95433);
    }
    .spotify-embed {
      width: 100%;
      min-height: 80px;
      border-radius: 12px;
      overflow: hidden;
      border: none;
      box-shadow: 0 2px 10px 0 #1db95422;
    }
    /* Canvas Game */
    .game-section {
      margin: 0 auto 36px auto;
      width: 370px;
      max-width: 92vw;
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
    }
    .game-section h3 {
      margin-bottom: 10px;
      color: #d72660;
      font-size: 1.18em;
      font-family: 'Pacifico', cursive, sans-serif;
      letter-spacing: 0.5px;
      text-shadow: 0 2px 8px #ffb6ea33;
    }
    #heart-canvas {
      background: #fff0f6;
      border-radius: 14px;
      box-shadow: 0 2px 14px 0 rgba(215,38,96,0.10);
      display: block;
      margin-bottom: 8px;
      border: 2px solid #f8bbd0;
      transition: box-shadow 0.2s;
    }
    #score {
      font-family: 'Quicksand', Arial, sans-serif;
      color: #7b2ff2;
      font-size: 1.08em;
      margin-bottom: 6px;
      font-weight: 600;
      letter-spacing: 0.5px;
      text-shadow: 0 1px 4px #e0c3fc55;
    }
    /* Polaroid Cards */
    .polaroid-section {
      width: 370px;
      max-width: 92vw;
      margin: 0 auto 36px auto;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .polaroid-viewer {
      position: relative;
      width: 260px;
      height: 320px;
      background: #fff;
      border-radius: 18px;
      box-shadow: 0 8px 28px 0 rgba(123,47,242,0.18), 0 2px 10px 0 #ffb6ea22;
      border: 7px solid #f5f5f5;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      margin-bottom: 16px;
      transition: transform 0.25s cubic-bezier(.4,2,.6,1), box-shadow 0.2s;
      /* Polaroid tilt effect */
      transform: rotate(-3deg);
    }
    .polaroid-viewer.tilt-right {
      transform: rotate(3deg);
    }
    .polaroid-img {
      width: 180px;
      height: 180px;
      object-fit: cover;
      border-radius: 12px;
      margin-top: 28px;
      margin-bottom: 18px;
      box-shadow: 0 2px 12px 0 #7b2ff222;
      border: 2px solid #e0c3fc;
      transition: opacity 0.45s cubic-bezier(.4,2,.6,1), transform 0.45s cubic-bezier(.4,2,.6,1);
      /* Add for rolling effect */
    }
    .polaroid-img.rolling-out {
      opacity: 0;
      transform: rotate(-30deg) scale(0.7);
      transition: opacity 0.45s cubic-bezier(.4,2,.6,1), transform 0.45s cubic-bezier(.4,2,.6,1);
    }
    .polaroid-img.rolling-in {
      opacity: 0;
      transform: rotate(30deg) scale(0.7);
      transition: none;
    }
    .polaroid-img.rolling-in-active {
      opacity: 1;
      transform: rotate(0deg) scale(1);
      transition: opacity 0.45s cubic-bezier(.4,2,.6,1), transform 0.45s cubic-bezier(.4,2,.6,1);
    }
    .polaroid-caption {
      font-size: 1.18em;
      color: #d72660;
      margin-bottom: 18px;
      text-align: center;
      font-family: 'Pacifico', cursive, sans-serif;
      letter-spacing: 0.5px;
      text-shadow: 0 2px 8px #ffb6ea33;
    }
    .polaroid-controls {
      display: flex;
      justify-content: center;
      gap: 18px;
    }
    .polaroid-btn {
      background: linear-gradient(90deg, #e0c3fc 0%, #ffb6ea 100%);
      border: none;
      border-radius: 10px;
      padding: 8px 22px;
      font-size: 1.05em;
      color: #7b2ff2;
      cursor: pointer;
      font-family: 'Quicksand', Arial, sans-serif;
      font-weight: 600;
      box-shadow: 0 2px 8px 0 #e0c3fc33;
      transition: background 0.2s, box-shadow 0.2s, color 0.2s;
    }
    .polaroid-btn:hover {
      background: linear-gradient(90deg, #ffb6ea 0%, #e0c3fc 100%);
      color: #d72660;
      box-shadow: 0 4px 16px 0 #ffb6ea33;
    }
    /* Section navigation */
    .section {
      display: none;
      opacity: 0;
      transform: translateY(30px);
      transition: opacity 0.5s cubic-bezier(.4,2,.6,1), transform 0.5s cubic-bezier(.4,2,.6,1);
    }
    .section.active {
      display: block;
      opacity: 1;
      transform: translateY(0);
    }
    .section.leaving {
      opacity: 0;
      transform: translateY(-30px);
      transition: opacity 0.5s cubic-bezier(.4,2,.6,1), transform 0.5s cubic-bezier(.4,2,.6,1);
    }
    .section-nav {
      display: flex;
      justify-content: space-between;
      margin: 18px auto 0 auto;
      width: 220px;
      max-width: 90vw;
      gap: 16px;
    }
    .section-nav-btn {
      background: linear-gradient(90deg, #e0c3fc 0%, #ffb6ea 100%);
      border: none;
      border-radius: 10px;
      padding: 8px 22px;
      font-size: 1.05em;
      color: #7b2ff2;
      cursor: pointer;
      font-family: 'Quicksand', Arial, sans-serif;
      font-weight: 600;
      box-shadow: 0 2px 8px 0 #e0c3fc33;
      transition: background 0.2s, box-shadow 0.2s, color 0.2s;
    }
    .section-nav-btn:hover {
      background: linear-gradient(90deg, #ffb6ea 0%, #e0c3fc 100%);
      color: #d72660;
      box-shadow: 0 4px 16px 0 #ffb6ea33;
    }
    /* Heart pop animation */
    .heart-pop {
      position: absolute;
      pointer-events: none;
      z-index: 10;
      width: 40px;
      height: 40px;
      left: 0;
      top: 0;
      animation: popHeartAnim 0.5s forwards;
    }
    @keyframes popHeartAnim {
      0% { transform: scale(0.7) rotate(0deg); opacity: 1;}
      60% { transform: scale(1.3) rotate(20deg); opacity: 1;}
      100% { transform: scale(0.9) rotate(-10deg); opacity: 0;}
    }
    /* Heart transition animation for section navigation */
    .nav-heart-anim {
      position: fixed;
      left: 50%;
      top: 50%;
      width: 80px;
      height: 80px;
      z-index: 1000;
      pointer-events: none;
      transform: translate(-50%, -50%) scale(0.7);
      opacity: 0.85;
      animation: navHeartPop 0.7s cubic-bezier(.4,2,.6,1) forwards;
    }
    @keyframes navHeartPop {
      0% { transform: translate(-50%, -50%) scale(0.7) rotate(0deg); opacity: 0.85;}
      50% { transform: translate(-50%, -50%) scale(1.3) rotate(20deg); opacity: 1;}
      100% { transform: translate(-50%, -50%) scale(0.7) rotate(-10deg); opacity: 0;}
    }
    /* Broken heart style for pop animation */
    .broken-heart-pop {
      position: absolute;
      pointer-events: none;
      z-index: 11;
      width: 44px;
      height: 44px;
      left: 0;
      top: 0;
      animation: popHeartAnim 0.7s forwards;
    }
    /* Game over overlay */
    #game-over-overlay {
      position: absolute;
      left: 0; top: 0;
      width: 100%; height: 100%;
      background: rgba(255,255,255,0.92);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      border-radius: 14px;
      font-family: 'Quicksand', Arial, sans-serif;
      color: #d72660;
      font-size: 1.3em;
      font-weight: 600;
      z-index: 20;
      box-shadow: 0 2px 14px 0 rgba(215,38,96,0.10);
      display: none;
      text-align: center;
      animation: fadeIn 0.5s;
    }
    #game-over-overlay button {
      margin-top: 18px;
      background: linear-gradient(90deg, #e0c3fc 0%, #ffb6ea 100%);
      border: none;
      border-radius: 10px;
      padding: 8px 22px;
      font-size: 1em;
      color: #7b2ff2;
      cursor: pointer;
      font-family: 'Quicksand', Arial, sans-serif;
      font-weight: 600;
      box-shadow: 0 2px 8px 0 #e0c3fc33;
      transition: background 0.2s, box-shadow 0.2s, color 0.2s;
    }
    #game-over-overlay button:hover {
      background: linear-gradient(90deg, #ffb6ea 0%, #e0c3fc 100%);
      color: #d72660;
      box-shadow: 0 4px 16px 0 #ffb6ea33;
    }
    /* Floating message style */
    .floating-msg {
      position: fixed;
      z-index: 1200;
      background: linear-gradient(90deg, #ffb6ea 0%, #e0c3fc 100%);
      color: #d72660;
      font-family: 'Pacifico', cursive, sans-serif;
      font-size: 1.1em;
      border-radius: 18px;
      padding: 7px 18px;
      box-shadow: 0 2px 12px #e0c3fc55;
      opacity: 0;
      min-width: 60px;
      text-align: center;
      pointer-events: none;
      animation: msgPop 0.7s cubic-bezier(.4,2,.6,1) forwards, msgFadeOut 0.7s 1.7s forwards;
      transition: opacity 0.4s;
    }
    @keyframes msgPop {
      0% { opacity: 0; transform: scale(0.7) translateY(20px);}
      60% { opacity: 1; transform: scale(1.1) translateY(-5px);}
      100% { opacity: 1; transform: scale(1) translateY(0);}
    }
    @keyframes msgFadeOut {
      0% { opacity: 1;}
      100% { opacity: 0;}
    }
  </style>
</head>
<body>
  <!-- Floating animated hearts -->
  <svg class="floating-heart" style="left:10vw; width:48px; top:0; animation-delay:0s;" viewBox="0 0 32 32">
    <path d="M16 29s-13-8.35-13-16.5C3 6.5 8.5 2 16 10.5C23.5 2 29 6.5 29 12.5C29 20.65 16 29 16 29Z" fill="#ffb6ea"/>
  </svg>
  <svg class="floating-heart" style="left:80vw; width:38px; top:0; animation-delay:2s;" viewBox="0 0 32 32">
    <path d="M16 29s-13-8.35-13-16.5C3 6.5 8.5 2 16 10.5C23.5 2 29 6.5 29 12.5C29 20.65 16 29 16 29Z" fill="#e0c3fc"/>
  </svg>
  <svg class="floating-heart" style="left:50vw; width:32px; top:0; animation-delay:1s;" viewBox="0 0 32 32">
    <path d="M16 29s-13-8.35-13-16.5C3 6.5 8.5 2 16 10.5C23.5 2 29 6.5 29 12.5C29 20.65 16 29 16 29Z" fill="#ff5eae"/>
  </svg>
  <!-- Add more floating hearts for richer background -->
  <svg class="floating-heart heart-anim" style="left:20vw; width:32px; top:0; animation-delay:1.5s;" viewBox="0 0 32 32">
    <path d="M16 29s-13-8.35-13-16.5C3 6.5 8.5 2 16 10.5C23.5 2 29 6.5 29 12.5C29 20.65 16 29 16 29Z" fill="#f357a8"/>
  </svg>
  <svg class="floating-heart heart-anim" style="left:70vw; width:28px; top:0; animation-delay:3s;" viewBox="0 0 32 32">
    <path d="M16 29s-13-8.35-13-16.5C3 6.5 8.5 2 16 10.5C23.5 2 29 6.5 29 12.5C29 20.65 16 29 16 29Z" fill="#7b2ff2"/>
  </svg>
  <svg class="floating-heart heart-anim" style="left:35vw; width:24px; top:0; animation-delay:2.7s;" viewBox="0 0 32 32">
    <path d="M16 29s-13-8.35-13-16.5C3 6.5 8.5 2 16 10.5C23.5 2 29 6.5 29 12.5C29 20.65 16 29 16 29Z" fill="#ffb6ea"/>
  </svg>
  <!-- Main Card Section -->
  <div class="section active" id="section-0">
    <div class="main-card">
      <svg class="heart left" viewBox="0 0 32 32">
        <defs>
          <linearGradient id="pinkHeart" x1="0" y1="0" x2="1" y2="1">
            <stop offset="0%" stop-color="#ff5eae"/>
            <stop offset="100%" stop-color="#ffb6ea"/>
          </linearGradient>
        </defs>
        <path d="M16 29s-13-8.35-13-16.5C3 6.5 8.5 2 16 10.5C23.5 2 29 6.5 29 12.5C29 20.65 16 29 16 29Z" fill="url(#pinkHeart)"/>
      </svg>
      <svg class="heart right" viewBox="0 0 32 32">
        <defs>
          <linearGradient id="purpleHeart" x1="0" y1="0" x2="1" y2="1">
            <stop offset="0%" stop-color="#7b2ff2"/>
            <stop offset="100%" stop-color="#f357a8"/>
          </linearGradient>
        </defs>
        <path d="M16 29s-13-8.35-13-16.5C3 6.5 8.5 2 16 10.5C23.5 2 29 6.5 29 12.5C29 20.65 16 29 16 29Z" fill="url(#purpleHeart)"/>
      </svg>
      <h2>Dear Satakshi</h2>
      <div class="apology">
        I am truly sorryüò¢ for anything hurt you... I never meant to make you feel this way, and I hope you can forgive meüôè... You mean the world to meüíñ, and I promise to do better and make it up to you‚ú®...
      </div>
      <div class="signature">
        With all my love,‚ù§Ô∏è<br>
        Yours sincerely,<br>
        Sahil.üòä
      </div>
    </div>
    <div class="section-nav">
      <span></span>
      <button class="section-nav-btn" onclick="showSection(1)">Next &rarr;</button>
    </div>
  </div>

  <!-- Spotify Section -->
  <div class="section" id="section-1">
    <div class="spotify-section">
      <h3><span class="music-note">&#127925;</span>Songs Dedicated to You ü´µ</h3>
      <iframe class="spotify-embed" src="https://open.spotify.com/embed/track/3bQsp4Vr9Rg4fNCx6HPOgX?si=0ff4843082e34df" width="100%" height="80" frameborder="0" allowtransparency="true" allow="encrypted-media"></iframe>
      <div style="font-size:0.95em;color:#888;margin-bottom:6px;"></div>
      <!-- New song added below -->
      <iframe class="spotify-embed" src="https://open.spotify.com/embed/track/1ApfHqjOoBmJZ0SjdjzVyA?si=a4c9ff869aeb4885" width="100%" height="80" frameborder="0" allowtransparency="true" allow="encrypted-media"></iframe>
      <div style="font-size:0.95em;color:#888;margin-bottom:6px;"></div>
      <!-- Added requested song below -->
      <iframe class="spotify-embed" src="https://open.spotify.com/embed/track/69Qzz3yyQSsA0T95jLDoPL?si=31b17aae291d4c91" width="100%" height="80" frameborder="0" allowtransparency="true" allow="encrypted-media"></iframe>
      <div style="font-size:0.95em;color:#888;margin-bottom:6px;"></div>
      <!-- Song: tuja paa ka jawab milaa hai asal -->
      <iframe class="spotify-embed" src="https://open.spotify.com/embed/track/5PetOhEX9N0oyBB0Keqobv?si=bf0124790a9e4008" width="100%" height="80" frameborder="0" allowtransparency="true" allow="encrypted-media"></iframe>
      <div style="font-size:0.95em;color:#888;margin-bottom:6px;"></div>
    </div>
    <div class="section-nav">
      <button class="section-nav-btn" onclick="showSection(0)">&larr; Previous</button>
      <button class="section-nav-btn" onclick="showSection(2)">Next &rarr;</button>
    </div>
  </div>

  <!-- Canvas Game Section -->
  <div class="section" id="section-2">
    <div class="game-section" style="position:relative;">
      <h3>Catch the Falling Hearts‚ù§Ô∏è!</h3>
      <div id="score">Score: <span id="score-value">0</span></div>
      <div id="recent-scores" style="font-size:0.98em;color:#7b2ff2;font-family:'Quicksand',Arial,sans-serif;margin-bottom:4px;">
        Recent ScoresüîÅ: <span id="recent-scores-list">-</span>
      </div>
      <div id="high-score" style="font-size:0.98em;color:#d72660;font-family:'Quicksand',Arial,sans-serif;margin-bottom:8px;">
        Highest ScoreüèÜ: <span id="high-score-value">-</span>
      </div>
      <div style="position:relative;">
        <canvas id="heart-canvas" width="320" height="220"></canvas>
        <div id="game-over-overlay">
          <div id="game-over-message"></div>
          <button onclick="restartGame()">Restart</button>
        </div>
      </div>
      <div style="font-size:0.98em;color:#888;font-family:'Quicksand',Arial,sans-serif;">Tap the hearts to make them disappear‚ù§Ô∏è!<br>If you click a broken heartüíî or left any ‚ù§Ô∏è, <br>the game endsüò£.</div>
    </div>
    <div class="section-nav">
      <button class="section-nav-btn" onclick="showSection(1)">&larr; Previous</button>
      <button class="section-nav-btn" onclick="showSection(3)">Next &rarr;</button>
    </div>
  </div>

  <!-- Polaroid Cards Section -->
  <div class="section" id="section-3">
    <div class="polaroid-section">
      <div class="polaroid-viewer" id="polaroid-viewer">
        <img class="polaroid-img" id="polaroid-img" src="https://images.unsplash.com/photo-1517841905240-472988babdf9?auto=format&fit=facearea&w=400&h=400&q=80" alt="Love you">
        <div class="polaroid-caption" id="polaroid-caption">Love you</div>
      </div>
      <div class="polaroid-controls">
        <button class="polaroid-btn" id="prev-card">Previous</button>
        <button class="polaroid-btn" id="next-card">Next</button>
      </div>
    </div>
    <div class="section-nav">
      <button class="section-nav-btn" onclick="showSection(2)">&larr; Previous</button>
      <span></span>
    </div>
  </div>

  <!-- Background loving tune -->
  <audio id="bg-music" src="audio 1.m4a" autoplay loop></audio>
  <style>
    #bg-music { display: none; }
  </style>

  <script>
    // Section navigation logic with animation
    let currentSection = 0;
    function showSection(idx) {
      if (idx === currentSection) return;
      // Heart animation on navigation
      createNavHeartAnim();
      const prev = document.getElementById('section-' + currentSection);
      const next = document.getElementById('section-' + idx);
      prev.classList.remove('active');
      prev.classList.add('leaving');
      setTimeout(() => {
        prev.classList.remove('leaving');
        next.classList.add('active');
        currentSection = idx;
        window.scrollTo({top: 0, behavior: 'smooth'});
      }, 500);
    }

    // Heart animation for section navigation
    function createNavHeartAnim() {
      const colors = ['#ff5eae', '#f357a8', '#7b2ff2', '#ffb6ea'];
      const color = colors[Math.floor(Math.random() * colors.length)];
      const heart = document.createElement('div');
      heart.className = 'nav-heart-anim';
      heart.innerHTML = `<svg width="80" height="80" viewBox="0 0 32 32">
        <path d="M16 29s-13-8.35-13-16.5C3 6.5 8.5 2 16 10.5C23.5 2 29 6.5 29 12.5C29 20.65 16 29 16 29Z" fill="${color}"/>
      </svg>`;
      document.body.appendChild(heart);
      setTimeout(() => heart.remove(), 700);
    }

    // Falling Hearts Game with broken hearts
    const canvas = document.getElementById('heart-canvas');
    const ctx = canvas.getContext('2d');
    const hearts = [];
    const heartColors = ['#ff5eae', '#f357a8', '#7b2ff2', '#ffb6ea'];
    const heartSize = 28;
    let lastSpawn = 0;
    let score = 0;
    let gameOver = false;

    // Add a variable to control heart speed scaling
    let heartSpeedScale = 1;

    function getCurrentSpeedScale() {
      // Increase speed after every 10 hearts clicked (score)
      return 1 + Math.floor(score / 10) * 0.45;
    }

    function drawHeart(x, y, size, color) {
      ctx.save();
      ctx.beginPath();
      ctx.moveTo(x, y + size * 0.3);
      ctx.bezierCurveTo(x, y, x - size / 2, y, x - size / 2, y + size * 0.3);
      ctx.bezierCurveTo(x - size / 2, y + size * 0.6, x, y + size * 0.9, x, y + size);
      ctx.bezierCurveTo(x, y + size * 0.9, x + size / 2, y + size * 0.6, x + size / 2, y + size * 0.3);
      ctx.bezierCurveTo(x + size / 2, y, x, y, x, y + size * 0.3);
      ctx.closePath();
      ctx.fillStyle = color;
      ctx.shadowColor = color;
      ctx.shadowBlur = 8;
      ctx.fill();
      ctx.restore();
    }

    function drawBrokenHeart(x, y, size) {
      ctx.save();
      ctx.beginPath();
      // Left half
      ctx.moveTo(x, y + size * 0.3);
      ctx.bezierCurveTo(x, y, x - size / 2, y, x - size / 2, y + size * 0.3);
      ctx.bezierCurveTo(x - size / 2, y + size * 0.6, x, y + size * 0.9, x, y + size);
      ctx.lineTo(x, y + size * 0.3);
      ctx.closePath();
      ctx.fillStyle = "#d72660";
      ctx.shadowColor = "#d72660";
      ctx.shadowBlur = 8;
      ctx.fill();
      // Right half
      ctx.beginPath();
      ctx.moveTo(x, y + size * 0.3);
      ctx.bezierCurveTo(x, y, x + size / 2, y, x + size / 2, y + size * 0.3);
      ctx.bezierCurveTo(x + size / 2, y + size * 0.6, x, y + size * 0.9, x, y + size);
      ctx.lineTo(x, y + size * 0.3);
      ctx.closePath();
      ctx.fillStyle = "#7b2ff2";
      ctx.shadowColor = "#7b2ff2";
      ctx.shadowBlur = 8;
      ctx.fill();
      // Draw zigzag "crack"
      ctx.save();
      ctx.strokeStyle = "#fff";
      ctx.lineWidth = 2.2;
      ctx.beginPath();
      ctx.moveTo(x, y + size * 0.3);
      ctx.lineTo(x - 3, y + size * 0.45);
      ctx.lineTo(x + 3, y + size * 0.55);
      ctx.lineTo(x - 2, y + size * 0.7);
      ctx.lineTo(x + 2, y + size * 0.85);
      ctx.stroke();
      ctx.restore();
      ctx.restore();
    }

    function spawnHeart() {
      const x = Math.random() * (canvas.width - heartSize) + heartSize / 2;
      // Use current speed scale for new hearts
      const speed = (0.7 + Math.random() * 1.1) * heartSpeedScale; // slower at start
      // 15% chance to spawn a broken heart
      const isBroken = Math.random() < 0.15;
      let color = heartColors[Math.floor(Math.random() * heartColors.length)];
      hearts.push({ x, y: -heartSize, speed, color, broken: isBroken });
    }

    function updateHearts() {
      for (let i = hearts.length - 1; i >= 0; i--) {
        hearts[i].y += hearts[i].speed;
        // If a normal heart misses (goes out of canvas), game over
        if (hearts[i].y > canvas.height + heartSize) {
          if (!hearts[i].broken) {
            showGameOver();
            return; // Stop further processing
          }
          // Remove broken heart silently
          hearts.splice(i, 1);
        }
      }
    }

    function drawHearts() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      for (const heart of hearts) {
        if (heart.broken) {
          drawBrokenHeart(heart.x, heart.y, heartSize);
        } else {
          drawHeart(heart.x, heart.y, heartSize, heart.color);
        }
      }
    }

    function gameLoop(ts) {
      if (gameOver) return;
      if (!lastSpawn || ts - lastSpawn > 700) {
        spawnHeart();
        lastSpawn = ts;
      }
      updateHearts();
      drawHearts();
      requestAnimationFrame(gameLoop);
    }

    // Update speed scale when score increases
    function updateScore() {
      document.getElementById('score-value').textContent = score;
      // Update speed scale based on score
      heartSpeedScale = getCurrentSpeedScale();
    }

    function createHeartPop(x, y, color, broken = false) {
      let pop;
      if (broken) {
        pop = document.createElement('div');
        pop.className = 'broken-heart-pop';
        pop.style.left = (canvas.offsetLeft + x - 22) + 'px';
        pop.style.top = (canvas.offsetTop + y - 22 + window.scrollY) + 'px';
        pop.innerHTML = `<svg width="44" height="44" viewBox="0 0 32 32">
          <g>
            <path d="M16 29s-13-8.35-13-16.5C3 6.5 8.5 2 16 10.5C23.5 2 29 6.5 29 12.5C29 20.65 16 29 16 29Z" fill="#d72660"/>
            <path d="M16 29s13-8.35 13-16.5C29 6.5 23.5 2 16 10.5C8.5 2 3 6.5 3 12.5C3 20.65 16 29 16 29Z" fill="#7b2ff2"/>
            <polyline points="16,13 13,17 17,19 14,23" fill="none" stroke="#fff" stroke-width="2"/>
          </g>
        </svg>`;
      } else {
        pop = document.createElement('div');
        pop.className = 'heart-pop';
        pop.style.left = (canvas.offsetLeft + x - 20) + 'px';
        pop.style.top = (canvas.offsetTop + y - 20 + window.scrollY) + 'px';
        pop.innerHTML = `<svg width="40" height="40" viewBox="0 0 32 32">
          <path d="M16 29s-13-8.35-13-16.5C3 6.5 8.5 2 16 10.5C23.5 2 29 6.5 29 12.5C29 20.65 16 29 16 29Z" fill="${color}"/>
        </svg>`;
      }
      document.body.appendChild(pop);
      setTimeout(() => pop.remove(), 600);
    }

    let recentScores = [];
    let highScore = 0;

    function updateRecentScoresDisplay() {
      const el = document.getElementById('recent-scores-list');
      if (!el) return;
      if (recentScores.length === 0) {
        el.textContent = '-';
      } else {
        el.textContent = recentScores.slice(-5).reverse().join(', ');
      }
    }

    function updateHighScoreDisplay() {
      const el = document.getElementById('high-score-value');
      if (!el) return;
      el.textContent = highScore > 0 ? highScore : '-';
    }

    function showGameOver() {
      gameOver = true;
      // Add score to recent scores
      if (score > 0) {
        recentScores.push(score);
        if (recentScores.length > 5) recentScores = recentScores.slice(-5);
        if (score > highScore) highScore = score;
      }
      updateRecentScoresDisplay();
      updateHighScoreDisplay();
      document.getElementById('game-over-message').innerHTML = `Game Overüòí!!!<br>Your ScoreüèÜ: <span style="color:#7b2ff2">${score}</span>`;
      document.getElementById('game-over-overlay').style.display = 'flex';
    }

    function restartGame() {
      score = 0;
      updateScore();
      hearts.length = 0;
      gameOver = false;
      document.getElementById('game-over-overlay').style.display = 'none';
      requestAnimationFrame(gameLoop);
    }

    canvas.addEventListener('click', function(e) {
      if (gameOver) return;
      const rect = canvas.getBoundingClientRect();
      const mx = e.clientX - rect.left;
      const my = e.clientY - rect.top;
      for (let i = hearts.length - 1; i >= 0; i--) {
        const dx = hearts[i].x - mx;
        const dy = hearts[i].y + heartSize/2 - my;
        if (dx * dx + dy * dy < (heartSize * 0.6) * (heartSize * 0.6)) {
          if (hearts[i].broken) {
            createHeartPop(mx, my, null, true);
            showGameOver();
          } else {
            createHeartPop(mx, my, hearts[i].color);
            score++;
            updateScore();
          }
          hearts.splice(i, 1);
          break;
        }
      }
    });

    canvas.addEventListener('touchstart', function(e) {
      if (gameOver) return;
      const rect = canvas.getBoundingClientRect();
      for (const touch of e.touches) {
        const mx = touch.clientX - rect.left;
        const my = touch.clientY - rect.top;
        for (let i = hearts.length - 1; i >= 0; i--) {
          const dx = hearts[i].x - mx;
          const dy = hearts[i].y + heartSize/2 - my;
          if (dx * dx + dy * dy < (heartSize * 0.6) * (heartSize * 0.6)) {
            if (hearts[i].broken) {
              createHeartPop(mx, my, null, true);
              showGameOver();
            } else {
              createHeartPop(mx, my, hearts[i].color);
              score++;
              updateScore();
            }
            hearts.splice(i, 1);
            break;
          }
        }
      }
    });
    requestAnimationFrame(gameLoop);

    // Polaroid Cards Viewer
    const cards = [
      {
        img: "image 1.jpg",
        caption: 'Love you ‚ù§Ô∏èü´µ'
      },
      {
        img: 'image 2.jpg',
        caption: "Don't be angyyyyyy!!!üò¢"
      },
      {
        img: 'image 3.jpg',
        caption: "You are my world üåè"
      },
      {
        img: 'image 11.jpg',
        caption: "Forever us üíñ"
      },
      // New pictures
      {
        img: 'image 9.jpg',
        caption: "Your smile makes my day üòä"
      },
      {
        img: 'image 6.jpg',
        caption: "Every moment with you is special ü´∂‚ù§Ô∏è"
      },
      {
        img: 'image 4.jpg',
        caption: "You are my happiness üòäü§ó"
      },
      // --- Added 3 more pictures below ---
      {
        img: 'image 10.jpg',
        caption: "You are my cutieeeü§ó‚ú®"
      },
      {
        img: 'image 17.jpg',
        caption: "Best memories together üì∏"
      },
      {
        img: 'image 15.jpg',
        caption: "You are my kuchpuchhhhü§óüíñ"
      },
      {
        img: 'image 16.jpg',
        caption: "Ummmmmmmaaaaaaaa üòòüòò"
      },
      {
        img: 'image 12.jpg',
        caption: "You are my cutiepieeeü§óüíñ"
      }
    ];
    let currentCard = 0;
    let rolling = false;

    function showCard(idx, direction = 1) {
      if (rolling) return;
      rolling = true;
      const img = document.getElementById('polaroid-img');
      const caption = document.getElementById('polaroid-caption');
      // Animate out
      img.classList.remove('rolling-in', 'rolling-in-active');
      img.classList.add('rolling-out');
      setTimeout(() => {
        // Change image and caption after fade out
        img.classList.remove('rolling-out');
        img.classList.add('rolling-in');
        img.src = cards[idx].img;
        caption.textContent = cards[idx].caption;
        // Polaroid tilt effect
        const viewer = document.getElementById('polaroid-viewer');
        viewer.classList.remove('tilt-right');
        if (idx % 2 === 1) viewer.classList.add('tilt-right');
        // Animate in
        setTimeout(() => {
          img.classList.add('rolling-in-active');
          setTimeout(() => {
            img.classList.remove('rolling-in', 'rolling-in-active');
            rolling = false;
          }, 450);
        }, 10);
      }, 450);
    }
    document.getElementById('prev-card').onclick = function() {
      if (rolling) return;
      const nextIdx = (currentCard - 1 + cards.length) % cards.length;
      currentCard = nextIdx;
      showCard(currentCard, -1);
    };
    document.getElementById('next-card').onclick = function() {
      if (rolling) return;
      const nextIdx = (currentCard + 1) % cards.length;
      currentCard = nextIdx;
      showCard(currentCard, 1);
    };
    // Initialize first card
    // Set initial state for rolling-in
    const polaroidImg = document.getElementById('polaroid-img');
    polaroidImg.classList.add('rolling-in', 'rolling-in-active');
    setTimeout(() => {
      polaroidImg.classList.remove('rolling-in', 'rolling-in-active');
    }, 500);
    showCard(currentCard, 1);

    // Initialize score and recent/high scores display
    updateScore();
    updateRecentScoresDisplay();
    updateHighScoreDisplay();

    // Floating messages logic (no doll, random positions)
    const dollMessages = [
      "Hiiii üíñ",
      "Cutie üòä",
      "Love you üíï",
      "Miss you üòò",
      "Ummmmaaaa üòòüòò",
      "Smile please ! ü§ó",
      "Stay happy ! üôÇ ",
      "My world üåè",
      "Cutiepieee ü§óüíñ",
    ];
    let msgIndex = 0;
    let msgTimeout = null;

    function getRandomMsgPosition() {
      const vw = Math.max(document.documentElement.clientWidth || 0, window.innerWidth || 0);
      const vh = Math.max(document.documentElement.clientHeight || 0, window.innerHeight || 0);
      // Estimate message size
      const msgW = 160, msgH = 48;
      const minX = 10, minY = 10;
      const maxX = vw - msgW - 10;
      const maxY = vh - msgH - 10;
      const left = Math.floor(Math.random() * (maxX - minX + 1)) + minX;
      const top = Math.floor(Math.random() * (maxY - minY + 1)) + minY;
      return { left, top };
    }

    function showFloatingMsg() {
      // Remove any existing floating message
      const oldMsg = document.querySelector('.floating-msg');
      if (oldMsg) oldMsg.remove();

      // Get random position
      const { left, top } = getRandomMsgPosition();

      // Create and show message
      const msgDiv = document.createElement('div');
      msgDiv.className = 'floating-msg';
      msgDiv.textContent = dollMessages[msgIndex];
      msgDiv.style.left = left + 'px';
      msgDiv.style.top = top + 'px';
      document.body.appendChild(msgDiv);

      // Remove after animation
      setTimeout(() => {
        msgDiv.remove();
        msgIndex = (msgIndex + 1) % dollMessages.length;
        msgTimeout = setTimeout(showFloatingMsg, 2200);
      }, 2400);
    }

    // Start showing messages on load
    window.addEventListener('DOMContentLoaded', () => {
      showFloatingMsg();
    });

    // --- Ensure background audio plays after user interaction ---
    function playBgMusic() {
      var audio = document.getElementById('bg-music');
      if (audio) {
        audio.muted = false;
        var playPromise = audio.play();
        if (playPromise !== undefined) {
          playPromise.catch(function() {
            // Try again on next interaction
          });
        }
      }
    }
    window.addEventListener('DOMContentLoaded', function() {
      playBgMusic();
      // Play on first user interaction if not already playing
      function enableAudioOnce() {
        playBgMusic();
        window.removeEventListener('click', enableAudioOnce);
        window.removeEventListener('touchstart', enableAudioOnce);
      }
      window.addEventListener('click', enableAudioOnce);
      window.addEventListener('touchstart', enableAudioOnce);
    });

    // --- Pause/resume background music when Spotify is interacted with ---
    function pauseBgMusic() {
      var audio = document.getElementById('bg-music');
      if (audio && !audio.paused) audio.pause();
    }
    function resumeBgMusic() {
      var audio = document.getElementById('bg-music');
      if (audio && audio.paused) {
        var playPromise = audio.play();
        if (playPromise !== undefined) {
          playPromise.catch(function(){});
        }
      }
    }

    // Helper to detect focus/blur on Spotify iframes
    function setupSpotifyAudioControl() {
      var spotifyIframes = document.querySelectorAll('.spotify-embed');
      spotifyIframes.forEach(function(iframe) {
        // Pause bg music when iframe is focused (user interacts)
        iframe.addEventListener('focus', pauseBgMusic);
        iframe.addEventListener('pointerdown', pauseBgMusic);
        iframe.addEventListener('mouseenter', pauseBgMusic);
        // Resume bg music when focus leaves iframe
        iframe.addEventListener('blur', resumeBgMusic);
        iframe.addEventListener('pointerleave', resumeBgMusic);
        iframe.addEventListener('mouseleave', resumeBgMusic);
      });
      // Also resume bg music when user clicks/taps outside any iframe
      document.body.addEventListener('click', function(e) {
        if (![...spotifyIframes].some(f => f === document.activeElement)) {
          resumeBgMusic();
        }
      });
    }
    window.addEventListener('DOMContentLoaded', function() {
      setupSpotifyAudioControl();
    });
  </script>
</body>
</html>